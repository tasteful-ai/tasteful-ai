<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
<h1>Chat Room Test</h1>
<label for="room-id">Chat Room ID:</label>
<input type="text" id="room-id" placeholder="Enter Chat Room ID">
<br><br>
<label for="token">JWT Token:</label>
<input type="text" id="token" placeholder="Enter JWT Token">
<br><br>
<button id="connect-btn">Connect</button>
<button id="disconnect-btn">Disconnect</button>
<br><br>
<textarea id="chat-box" rows="10" cols="50" readonly></textarea>
<br><br>
<input type="text" id="message" placeholder="Enter your message">
<button id="send-btn">Send Message</button>

<script>
    let stompClient = null;

    document.getElementById('connect-btn').addEventListener('click', () => {
        const roomId = document.getElementById('room-id').value;
        const token = document.getElementById('token').value;

        if (!roomId || !token) {
            alert('Room ID and Token are required!');
            return;
        }

        const socket = new SockJS('/ws-chat');
        stompClient = Stomp.over(socket);

        stompClient.connect({Authorization: token}, () => {
            stompClient.subscribe(`/sub/chatroom/${roomId}`, (message) => {
                const chatBox = document.getElementById('chat-box');
                const data = JSON.parse(message.body);
                chatBox.value += `[${data.senderNickname}] ${data.message}\n`;
            });

            alert('Connected to WebSocket!');
        }, (error) => {
            console.error('Error connecting to WebSocket:', error);
        });
    });

    document.getElementById('disconnect-btn').addEventListener('click', () => {
        if (stompClient) {
            stompClient.disconnect(() => {
                alert('Disconnected from WebSocket!');
            });
        }
    });

    document.getElementById('send-btn').addEventListener('click', () => {
        const roomId = document.getElementById('room-id').value;
        const message = document.getElementById('message').value;

        if (!roomId || !message) {
            alert('Room ID and message are required!');
            return;
        }

        stompClient.send('/pub/chat', {}, JSON.stringify({
            chattingroomId: roomId,
            message: message,
            type: 'TALK'
        }));
    });
</script>
</body>
</html>
