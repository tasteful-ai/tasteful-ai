<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì‚¬ìš©ì ìœ„ì¹˜ ê¸°ë°˜ ë§›ì§‘ ê²€ìƒ‰</title>
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KAKAO_JAVASCRIPT_API&libraries=services"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    #container {
      display: flex;
      flex: 1;
    }

    #map {
      flex: 6;
      height: 100%;
    }

    #placesList {
      flex: 4;
      height: 100%;
      overflow-y: auto;
      border-left: 1px solid #ddd;
      padding: 10px;
      box-sizing: border-box;
    }

    #placesList li {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      cursor: pointer;
    }

    #placesList li:hover {
      background: #f5f5f5;
    }

    #pagination {
      margin: 10px 0;
      text-align: center;
      clear: both;
    }

    #pagination a {
      margin: 0 5px;
      text-decoration: none;
      color: #333;
    }

    #pagination a:hover {
      text-decoration: underline;
    }

    header {
      padding: 10px;
      background: #f8f8f8;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }

    header input {
      padding: 5px;
      margin-right: 5px;
      width: 200px;
    }

    header button {
      padding: 5px 10px;
    }
  </style>
</head>
<body>
<header>
  <h1>ë§›ì§‘ ë ˆì´ë” ì‘ë™ ì¤‘â€¦ ë°°ê°€ ê³ í”„ë‹¤ë©´ ê²€ìƒ‰í•˜ì„¸ìš”!</h1>
  <input type="text" id="keyword" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" value="">
  <button onclick="searchPlaces()">ê²€ìƒ‰</button>
</header>
<div id="container">
  <div id="map"></div>
  <ul id="placesList"></ul>
</div>
<div id="pagination"></div>

<script>
  var mapContainer = document.getElementById('map');
  var mapOption = {
    center: new kakao.maps.LatLng(37.566826, 126.9786567), // ê¸°ë³¸ ì¢Œí‘œ (ì„œìš¸ ì¤‘ì‹¬)
    level: 5 // í™•ëŒ€ ë ˆë²¨
  };

  var map = new kakao.maps.Map(mapContainer, mapOption);
  var ps = new kakao.maps.services.Places(); // ì¥ì†Œ ê²€ìƒ‰ ê°ì²´ ìƒì„±
  var infowindow = new kakao.maps.InfoWindow({ zIndex: 1 }); // ì¸í¬ìœˆë„ìš° ìƒì„±
  var currentPosition = null;

  // í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸° ë° ì§€ë„ ì¤‘ì‹¬ ì„¤ì •
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
            function (position) {
              currentPosition = new kakao.maps.LatLng(position.coords.latitude, position.coords.longitude);
              map.setCenter(currentPosition); // ì§€ë„ ì¤‘ì‹¬ì„ í˜„ì¬ ìœ„ì¹˜ë¡œ ì„¤ì •
              displayCurrentLocationMarker(); // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ í‘œì‹œ
            },
            function (error) {
              alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ì–´ ê¸°ë³¸ ìœ„ì¹˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.");
            }
    );
  } else {
    alert("ìœ„ì¹˜ ì •ë³´ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
  }

  function displayCurrentLocationMarker() {
    var marker = new kakao.maps.Marker({
      map: map,
      position: currentPosition, // í˜„ì¬ ìœ„ì¹˜ ì¢Œí‘œ
      title: "í˜„ìœ„ì¹˜", // ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ í‘œì‹œë˜ëŠ” í…ìŠ¤íŠ¸
    });

    // ë§ˆì»¤ë¥¼ í´ë¦­í–ˆì„ ë•Œ ê°„ë‹¨í•œ ì•Œë¦¼ì°½ (í•„ìš”í•˜ì§€ ì•Šìœ¼ë©´ ì œê±° ê°€ëŠ¥)
    kakao.maps.event.addListener(marker, 'click', function () {
      alert('í˜„ì¬ ìœ„ì¹˜ì…ë‹ˆë‹¤ğŸ˜');
    });
  }

  // ì¥ì†Œ ê²€ìƒ‰ ì‹¤í–‰
  function searchPlaces() {
    var keyword = document.getElementById('keyword').value.trim();

    if (!keyword) {
      alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
      return;
    }

    ps.keywordSearch(keyword, placesSearchCB, {
      location: currentPosition || map.getCenter(), // í˜„ì¬ ìœ„ì¹˜ ê¸°ì¤€ ê²€ìƒ‰
      radius: 5000, // 5km ë°˜ê²½
      size: 10 // ìµœëŒ€ 10ê°œ ê²°ê³¼
    });
  }

  // ê²€ìƒ‰ ê²°ê³¼ ì²˜ë¦¬
  function placesSearchCB(data, status) {
    if (status === kakao.maps.services.Status.OK) {
      displayPlaces(data); // ê²€ìƒ‰ ê²°ê³¼ ì§€ë„ì™€ ëª©ë¡ì— í‘œì‹œ
    } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
      alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
    } else {
      alert('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  }

  // ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
  function displayPlaces(places) {
    var listEl = document.getElementById('placesList');
    var bounds = new kakao.maps.LatLngBounds();

    listEl.innerHTML = ''; // ê¸°ì¡´ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”

    for (var i = 0; i < places.length; i++) {
      var place = places[i];
      var itemEl = document.createElement('li'); // ëª©ë¡ ì•„ì´í…œ ìƒì„±

      itemEl.innerHTML = `
        <span>${i + 1}. </span>
        <strong>${place.place_name}</strong><br>
        <small>${place.road_address_name || place.address_name}</small><br>
        <small>${place.phone || 'ì „í™”ë²ˆí˜¸ ì—†ìŒ'}</small>
      `;

      listEl.appendChild(itemEl);
      (function (marker, title) {
        kakao.maps.event.addListener(marker, 'mouseover', function () {
          infowindow.setContent(`<div style="padding:5px;">${title}</div>`);
          infowindow.open(map, marker);
        });

        kakao.maps.event.addListener(marker, 'mouseout', function () {
          infowindow.close();
        });

        itemEl.onmouseover = function () {
          infowindow.setContent(`<div style="padding:5px;">${title}</div>`);
          infowindow.open(map, marker);
        };

        itemEl.onmouseout = function () {
          infowindow.close();
        };
      })(displayMarker(place), place.place_name);

      bounds.extend(new kakao.maps.LatLng(place.y, place.x));
    }

    map.setBounds(bounds); // ê²€ìƒ‰ ê²°ê³¼ì— ë§ê²Œ ì§€ë„ ë²”ìœ„ ì„¤ì •
  }

  // ì¥ì†Œ ë§ˆì»¤ í‘œì‹œ
  function displayMarker(place) {
    var marker = new kakao.maps.Marker({
      map: map,
      position: new kakao.maps.LatLng(place.y, place.x)
    });
    return marker;
  }
</script>